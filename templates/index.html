{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block title %}Index{% endblock %}

{% block page_content %}
<div class="page-header">
    <h1>Γεια σου ταλαίπωρε</h1>
</div>

{{ wtf.quick_form(form) }}

{% endblock %}

{% block scripts %}
{{ super() }}
<script charset="utf-8" type="text/javascript">

$(function() {

    // jQuery selection for the select fields
    var dropdown = {
        sxoliko_etos: $('#select_sxoliko_etos'),
        kathgoria: $('#select_kathgoria'),
        smeae_pinakas: $('#select_smeae_pinakas'),
        smeae_kathgoria: $('#select_smeae_kathgoria'),
        klados: $('#select_klados'),
        hmeromhnia: $('#select_hmeromhnia'),
        perioxh: $('#select_perioxh'),
        mousiko_organo: $('#select_mousiko_organo'),
        athlima: $('#select_athlima'),
    };

    // call to update on load
    //updateKathgories();
    //updateKladoi();
    dropdown.kathgoria.attr('disabled', 'disabled');
    dropdown.klados.attr('disabled', 'disabled');
    dropdown.hmeromhnia.attr('disabled', 'disabled');   // hide too?

    //hidden select fields
    $('label[for="select_smeae_pinakas"]').hide();
    dropdown.smeae_pinakas.hide();
    $('label[for="select_smeae_kathgoria"]').hide();
    dropdown.smeae_kathgoria.hide();
    $('label[for="select_perioxh"]').hide();
    dropdown.perioxh.hide();
    $('label[for="select_mousiko_organo"]').hide();
    dropdown.mousiko_organo.hide();
    $('label[for="select_athlima"]').hide();
    dropdown.athlima.hide();

    // function to call XHR and update kathgoria dropdown
    function updateKathgories() {
        var send =  {
            sxoliko_etos: dropdown.sxoliko_etos.val()
        };

        alert(send.sxoliko_etos);

        dropdown.kathgoria.empty();

        // smeae
        $('label[for="select_smeae_pinakas"]').hide();
        dropdown.smeae_pinakas.hide();
        $('label[for="select_smeae_kathgoria"]').hide();
        dropdown.smeae_kathgoria.hide();

        dropdown.klados.empty();
        dropdown.hmeromhnia.empty();
        dropdown.klados.attr('disabled', 'disabled');
        dropdown.hmeromhnia.attr('disabled', 'disabled');

        $.getJSON("{{ url_for('_get_kathgories') }}", send, function(data) {
            data.forEach(function(item) {
                dropdown.kathgoria.append(
                    $('<option>', {
                        value: item[0],
                        text: item[1]
                    })
                );
            });
            dropdown.kathgoria.removeAttr('disabled');
        });
    }

    // function to call XHR and update kladoi dropdown
    function updateKladoi() {
        var send =  {
            sxoliko_etos: dropdown.sxoliko_etos.val(),
            kathgoria: dropdown.kathgoria.val()
        };

        alert(send.sxoliko_etos + "\n" + send.kathgoria);

        //smeae
        //if (send.sxoliko_etos==1) {
        //    $('#select_smeae_pinakas').removeAttr('required');
        //    $('#select_smeae_pinakas').parent().removeClass('required');
        //   $('#select_smeae').removeAttr('required');
        //   $('#select_smeae').parent().removeClass('required');
        //} else
        if (((send.kathgoria==11) || (send.kathgoria==18) || (send.kathgoria==19))
            && (send.sxoliko_etos!=1)) {
            $('label[for="select_smeae_pinakas"]').show();
            $('#select_smeae_pinakas').show();
            $('label[for="select_smeae_kathgoria"]').show();
            $('#select_smeae_kathgoria').show();
        } else {
            $('label[for="select_smeae_pinakas"]').hide();
            $('#select_smeae_pinakas').hide();
            $('label[for="select_smeae_kathgoria"]').hide();
            $('#select_smeae_kathgoria').hide();
        }


        dropdown.klados.empty();
        dropdown.hmeromhnia.empty();
        dropdown.hmeromhnia.attr('disabled', 'disabled');

        $.getJSON("{{ url_for('_get_kladoi') }}", send, function(data) {
            data.forEach(function(item) {
                dropdown.klados.append(
                    $('<option>', {
                        value: item[0],
                        text: item[1]
                    })
                );
            });
            dropdown.klados.removeAttr('disabled');
        });
    }

    // function to call XHR and update hmeromhnia dropdown
    function updateHmeromhnies() {
        var send =  {
            sxoliko_etos: dropdown.sxoliko_etos.val(),
            kathgoria: dropdown.kathgoria.val(),
            klados: dropdown.klados.val()
        };

        alert(send.sxoliko_etos + "\n" + send.kathgoria + "\n" + send.klados);

        dropdown.hmeromhnia.empty();
        dropdown.hmeromhnia.removeAttr('disabled');
        //dropdown.hmeromhnia.attr('disabled', 'disabled');

        $.getJSON("{{ url_for('_get_hmeromhnies') }}", send, function(data) {
            data.forEach(function(item) {
                dropdown.hmeromhnia.append(
                    $('<option>', {
                        value: item[0],
                        text: item[1]
                    })
                );
            });
            dropdown.hmeromhnia.removeAttr('disabled');
        });
    }

    // event listeners to dropdown changes
    dropdown.sxoliko_etos.on('change', function() {
        updateKathgories();
    });

    dropdown.kathgoria.on('change', function() {
        updateKladoi();
    });

    dropdown.klados.on('change', function() {
        updateHmeromhnies();
    });

});

</script>
{% endblock %}